# xml-fixes

> [!IMPORTANT]
> Этот скрипт я написал в первую очередь для себя и пользуюсь им регулярно.
> 
> Доработка под другие трейдеры или иные моды в мои планы в данный момент не входит, однако я буду благодарен всем, кто будет помогить в развитии этого скрипта.

## Контактная информация:

- Дискорд: https://discord.gg/pww4zwz6rM
- Гитхаб: https://github.com/MPG-DayZ/xml-fixes

## Этот скрипт актуален для патча 1.26

Инструмент для лёгкого исправления ошибок в xml файлах сервера.

Предназначен в первую очередь для быстрого и массового исправления ошибок, допущенный как разработчиками DayZ, так и
админами сервера.

Этот скрипт имеет смысл запускать при больших изменениях в тайпсах или просто для проверки корректности.

## Что делает скрипт:

### 1. Исправляет ошибки в types.xml

- Некорректные названия класснеймов (16 штук) на корректные.
- Заменяет `count_in_map="0"` на `count_in_map="1"`.

### 2. Корректирует нулевые записи

- Находит записи в ванильном types.xml и в модовых тайпсах, которые прописаны в `cfgeconimycore.xml`, у которых nominal
  равен нулю и удаляет лишнее из этих записей.
- Прописывает `<nominal>`, `<restock>` и `<min>` равным нулю, если это не было сделано ранее.

### 3. Исправляет ошибки в mapgroupproto.xml

- Некорректные лимиты на спавн в некоторых местах.
- Увеличивает количество точек спавна лута до максимального во всех местах.

### 4. Исправляет ошибки в cfgeventgroups.xml

- Рудимент с некорректным двойным закрытием тега `/> />` который живёт уже много лет.

### 5. Корректирует другие ошибки

- Исправляет записи `<min>` там, где они больше, чем `<nominal>`
- Исправляет записи `<restock>` там, где они больше, чем `<lifetime> / <nominal>`

## Бонусы

### 1. Для пользователей TraderPlus

Работает только с модом TraderPlus!

Для проведения этой проверки необходимо установить мод и запустить сервер. (после чего мод можно удалить, он будет
замедлять старт сервера)

Выполняет следующие проверки:

#### 1. Показывает дубликаты товаров, которые есть в категориях.

Это очень негативно влияет на производительность сервера т.к. трейдер не может корректно определить товар, который
покупает или продаёт игрок.

#### 2. Проверяет корректность прописанных предметов в трейде и типах.

- **Предмет есть в игре, но нет в трейде:** Означает, что вы или не прописали предмет в трейд или так и должно быть.
  Этот параметр больше для информации.
- **Предмет есть в трейде, но нет в игре:** Означает, что предмета нет в игре. Это может быть удалённый предмет или
  класснейм содержит опечатку. Важный показатель.
- **Предмет есть в типах, но нет в трейде:** Предмет прописан в тайпсах, но не прописан в трейд. Это может быть как
  ошибка, так и нормальное явление. Проверка больше для информации.
- **Предмет есть в типах, но нет в игре:** Тут либо удалённый с сервера предмет, либо опечатка в типах.
- **Предмет есть в трейде, но нет в типах:** Тут опять же или опечатка или предмет забыли прописать или его вовсе нет.
- **Предмет есть в игре, но нет в типах:** Тут или опечатка в тайпсах или забыли прописать.
- **Предмет есть в спавне, но нет в трейде:** Простой способ избавиться от сообщений игроков о том, что что-то не
  продаётся в трейде.

В результате проверки будет создан json файл `checkTrader.json`, в котором будет подробная информация по каждому
класснейму, который попал в счётчик, а так же список дубликатов, если они будут обнаружены.

### 2. Бонус для тех, кто пользуется верстаком от COBA

- Помечает комментариями класснеймы в тайпсах, которые используются в крафте как ингридиенты и как результат крафта.

## Как пользоваться

> [!IMPORTANT]
> Для работы скрипта необходимо установить [NodeJS](https://nodejs.org)
> А так же перед первым запуском скрипта ОБЯЗАТЕЛЬНО сделать резервную копию файлов мисии
> Желательно использовать последнюю версию [powershell](https://aka.ms/PowerShell)

### Простой способ:

1. Поместить папку `xml-fixes` в корень сервера или рядом c папкой mpmissions.
2. Запустить файл `01.run.ps1` через powershell
3. Следовать инструкциям.

### Способ для продвинутых

```bash
npm ci
```

```bash
npm run start
``` 

или

```bash
node xml-fixe.js
```